import{d as $,u as M,p as v,q as m,c as d,a as c,b as l,h as E,w as _,e as t,i as x,o as p,F as S,r as F,t as r,n as H,v as h,g as w,l as J}from"./app-Cn4Mti0S.js";import{_ as L}from"./HeadingSmall.vue_vue_type_script_setup_true_lang-Ckr5NRvT.js";import{_ as j}from"./AppLogo-B52f7H_1.js";import{_ as z}from"./AppLayout.vue_vue_type_script_setup_true_lang-DpnE-rau.js";import"./utils-De-6wg0a.js";const G={class:"space-y-6 p-6"},O={class:"rounded-lg border bg-white p-6"},W={class:"flex gap-4"},X={class:"flex-1"},Y=["value"],Z={class:"w-24"},tt={class:"flex items-end"},et={class:"grid gap-6 lg:grid-cols-3"},st={class:"lg:col-span-2"},ot={class:"rounded-lg border bg-white p-6"},nt={class:"mb-4 text-lg font-semibold"},at={key:0,class:"py-8 text-center text-muted-foreground"},rt={key:1,class:"overflow-x-auto"},lt={class:"w-full"},ut={class:"px-6 py-3"},it={class:"px-6 py-3 text-right"},dt={class:"px-6 py-3"},ct=["value","onInput"],pt={class:"px-6 py-3 text-right font-medium"},mt={class:"px-6 py-3 text-center"},gt=["onClick"],bt={class:"space-y-4"},ft={class:"rounded-lg border bg-white p-6"},vt={class:"space-y-3 text-sm"},_t={class:"flex justify-between"},xt={class:"font-medium"},yt={class:"flex justify-between border-t border-b py-2 text-base font-bold"},kt={class:"text-orange-600"},ht={class:"rounded bg-orange-50 px-3 py-2 font-bold text-orange-700"},wt={class:"rounded-lg border bg-white p-6"},Tt={class:"space-y-2"},jt=$({__name:"Create",props:{products:{}},setup(K){const T=K,U=[{title:"Penjualan",href:"/transactions"},{title:"Transaksi Baru",href:"#"}],n=M({total_amount:0,discount_amount:0,final_amount:0,payment_amount:0,change_amount:0,payment_method:"tunai",notes:"",items:[]}),a=v([]),g=v(""),y=v("1"),q=v("0"),C=v("0"),u=m(()=>g.value?T.products.find(o=>o.id===parseInt(g.value)):null),I=m(()=>a.value.reduce((o,e)=>o+e.subtotal,0)),V=m(()=>parseInt(q.value)||0),k=m(()=>I.value-V.value),P=m(()=>parseInt(C.value)||0),B=m(()=>P.value-k.value),A=()=>{if(!u.value){alert("Pilih produk terlebih dahulu");return}const o=parseInt(y.value);if(o<=0){alert("Kuantitas harus lebih dari 0");return}if(o>u.value.stock_quantity){alert("Stok tidak cukup");return}const e=a.value.find(s=>s.product_id===u.value?.id);if(e){const s=e.quantity+o;if(s>u.value.stock_quantity){alert("Stok tidak cukup");return}e.quantity=s,e.subtotal=s*e.unit_price}else a.value.push({product_id:u.value.id,product_name:u.value.name,quantity:o,unit_price:u.value.selling_price,subtotal:o*u.value.selling_price});g.value="",y.value="1"},D=o=>{a.value.splice(o,1)},N=(o,e)=>{const s=parseInt(e);if(s<=0){D(o);return}const i=a.value[o],f=T.products.find(R=>R.id===i.product_id);if(f&&s>f.stock_quantity){alert("Stok tidak cukup");return}i.quantity=s,i.subtotal=s*i.unit_price},Q=()=>{if(a.value.length===0){alert("Keranjang masih kosong");return}if(P.value<k.value){alert("Pembayaran kurang");return}n.total_amount=I.value,n.discount_amount=V.value,n.final_amount=k.value,n.payment_amount=P.value,n.change_amount=B.value,n.items=a.value,n.post("/transactions",{onSuccess:()=>{alert("Transaksi berhasil!")},onError:o=>{console.log("Form errors:",o),alert("Ada kesalahan pada form")}})},b=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(o);return(o,e)=>(p(),d(S,null,[c(l(E),{title:"Transaksi Baru"}),c(z,{breadcrumbs:U},{default:_(()=>[t("div",G,[c(L,{title:"Transaksi Penjualan",description:"Buat transaksi penjualan baru"}),t("div",O,[e[9]||(e[9]=t("h3",{class:"mb-4 text-lg font-semibold"},"Tambah Produk",-1)),t("div",W,[t("div",X,[e[6]||(e[6]=t("label",{class:"text-sm font-medium"},"Produk",-1)),x(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),class:"mt-2 w-full rounded-lg border border-input bg-background px-3 py-2 focus:border-orange-400 focus:ring-2 focus:ring-orange-200"},[e[5]||(e[5]=t("option",{value:""},"Pilih Produk",-1)),(p(!0),d(S,null,F(T.products,s=>(p(),d("option",{key:s.id,value:s.id},r(s.name)+" (Stok: "+r(s.stock_quantity)+") ",9,Y))),128))],512),[[H,g.value]])]),t("div",Z,[e[7]||(e[7]=t("label",{class:"text-sm font-medium"},"Jumlah",-1)),x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s),type:"number",min:"1",class:"mt-2 w-full rounded-lg border border-input bg-background px-3 py-2 text-center focus:border-orange-400 focus:ring-2 focus:ring-orange-200"},null,512),[[h,y.value]])]),t("div",tt,[c(l(j),{onClick:A,class:"bg-orange-500 hover:bg-orange-600"},{default:_(()=>[...e[8]||(e[8]=[w(" Tambah ",-1)])]),_:1})])])]),t("div",et,[t("div",st,[t("div",ot,[t("h3",nt," Keranjang ("+r(a.value.length)+" item) ",1),a.value.length===0?(p(),d("div",at," Keranjang masih kosong ")):(p(),d("div",rt,[t("table",lt,[e[10]||(e[10]=t("thead",{class:"border-b bg-muted"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-sm font-semibold"}," Produk "),t("th",{class:"px-6 py-3 text-right text-sm font-semibold"}," Harga "),t("th",{class:"px-6 py-3 text-center text-sm font-semibold"}," Qty "),t("th",{class:"px-6 py-3 text-right text-sm font-semibold"}," Subtotal "),t("th",{class:"px-6 py-3 text-center text-sm font-semibold"}," Aksi ")])],-1)),t("tbody",null,[(p(!0),d(S,null,F(a.value,(s,i)=>(p(),d("tr",{key:i,class:"border-b hover:bg-gray-50"},[t("td",ut,r(s.product_name),1),t("td",it,r(b(s.unit_price)),1),t("td",dt,[t("input",{value:s.quantity,onInput:f=>N(i,f.target.value),type:"number",min:"1",class:"w-16 rounded border border-input px-2 py-1 text-center text-sm focus:border-orange-400 focus:ring-2 focus:ring-orange-200"},null,40,ct)]),t("td",pt,r(b(s.subtotal)),1),t("td",mt,[t("button",{onClick:f=>D(i),class:"text-red-600 hover:text-red-800"}," Hapus ",8,gt)])]))),128))])])]))])]),t("div",bt,[t("div",ft,[e[16]||(e[16]=t("h3",{class:"mb-4 text-lg font-semibold"},"Ringkasan",-1)),t("div",vt,[t("div",_t,[e[11]||(e[11]=t("span",{class:"text-muted-foreground"}," Subtotal ",-1)),t("span",xt,r(b(I.value)),1)]),t("div",null,[e[12]||(e[12]=t("label",{class:"text-sm font-medium"}," Diskon (Rp) ",-1)),x(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>q.value=s),type:"number",min:"0",class:"mt-1 w-full rounded border border-input px-2 py-1 text-right focus:border-orange-400 focus:ring-2 focus:ring-orange-200"},null,512),[[h,q.value]])]),t("div",yt,[e[13]||(e[13]=t("span",null,"Total",-1)),t("span",kt,r(b(k.value)),1)]),t("div",null,[e[14]||(e[14]=t("label",{class:"text-sm font-medium"}," Pembayaran (Rp) ",-1)),x(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>C.value=s),type:"number",min:"0",class:"mt-1 w-full rounded border border-input px-2 py-1 text-right focus:border-orange-400 focus:ring-2 focus:ring-orange-200"},null,512),[[h,C.value]])]),t("div",ht,[e[15]||(e[15]=t("div",{class:"text-xs font-normal text-orange-600"}," Kembalian ",-1)),w(" "+r(b(B.value)),1)])])]),t("div",wt,[e[17]||(e[17]=t("label",{class:"text-sm font-medium"},"Catatan",-1)),x(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>l(n).notes=s),placeholder:"Catatan transaksi (opsional)",class:"mt-2 w-full rounded-lg border border-input bg-background px-3 py-2 focus:border-orange-400 focus:ring-2 focus:ring-orange-200",rows:"3"},null,512),[[h,l(n).notes]])]),t("div",Tt,[c(l(j),{onClick:Q,disabled:a.value.length===0||l(n).processing,class:"w-full bg-orange-500 hover:bg-orange-600 disabled:opacity-50"},{default:_(()=>[w(r(l(n).processing?"Memproses...":"Selesaikan Transaksi"),1)]),_:1},8,["disabled"]),c(l(J),{href:"/transactions"},{default:_(()=>[c(l(j),{variant:"outline",class:"w-full"},{default:_(()=>[...e[18]||(e[18]=[w(" Batal ",-1)])]),_:1})]),_:1})])])])])]),_:1})],64))}});export{jt as default};
